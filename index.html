<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Allora Filosofal - Duelo de Ideias Sem Paix√£o</title>
    <style>

        * { box-sizing: border-box; }

        body { 
            margin: 0; padding: 10px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #fdfcfd; text-align: center; color: white; overflow-x: hidden;
        }

        #pageLoader {
            position: fixed; inset: 0; background: #9d5fe9;
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }

        .loader-circle {
            width: 60px; height: 60px; border: 6px solid rgba(255,255,255,0.3);
            border-top: 6px solid #fff; border-radius: 50%; animation: spin 1s linear infinite;
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .menu-caixa { 
            background: rgba(89, 188, 230, 0.9); backdrop-filter: blur(6px);
            color: #333; padding: 15px; border-radius: 20px; 
            max-width: 360px; width: 100%; margin: 15px auto; box-shadow: 0 10px 25px rgba(0,0,0,0.4); 
        }

        .banner-abertura { 
            display: flex; justify-content: center; align-items: center;
            gap: 8px; margin-bottom: 12px;
        }

       /* IMAGEM VERSUS CENTRAL */
        .img-versus {
            display: block;
            margin: 10px auto;
            width: 100vw;
            max-width: 280px;
            aspect-ratio: 1 / 1;
            object-fit: contain;
        }

        .seletor-tema {
            width: 100%; padding: 12px; margin: 10px 0;
            border-radius: 12px; border: 2px solid #9d5fe9;
            background: white; font-weight: bold; color: #4a148c;
        }

        .btn-aurora { 
            width: 100%; padding: 12px; margin: 6px 0; border: none; 
            border-radius: 16px; font-weight: bold; cursor: pointer; 
            color: white; font-size: 16px; transition: transform 0.2s ease;
        }

        .btn-aurora:active { transform: scale(0.97); }
        .roxo { background: #9B4FAD; }

        /* AJUSTE DOS CARDS - ALTURA AUMENTADA PARA CABER IMAGENS E NOMES */
        .cards-area { 
            display: none; justify-content: center; gap: 10px; 
            margin: 12px 0; padding: 10px; background: rgba(255,255,255,0.2);
            border-radius: 16px; flex-wrap: nowrap;
        }

        .card-container { width: 130px; } /* Largura levemente aumentada */

        .card { 
            width: 100%; height: 90%; background: #1a1a1a; /* Altura aumentada de 150px para 180px */
            border-radius: 12px; border: 3px solid #fff; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative;
        }

        .card img { width: 100%; height: 95%; object-fit: cover; object-position: top; }

        .label-card { 
            position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7);
            color: #fff; font-size: 10px; padding: 2px 0; font-weight: bold;
        }

        /* LABEL PARA O NOME DO FIL√ìSOFO */
        .nome-filosofo {
            margin-top: 8px; background: #4a148c; color: white;
            font-size: 11px; padding: 6px; border-radius: 8px;
            min-height: 35px; display: flex; align-items: center; justify-content: center;
            line-height: 1.1; font-weight: bold;
        }

        #status { margin: 10px 0; font-size: 14px; color: #333; font-weight: bold; padding: 0 10px; }

        #aiBox { 
            display: none; background: white; color: #333; padding: 18px; 
            border-radius: 15px; text-align: left; margin-top: 15px; 
            font-size: 15px; line-height: 1.6; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .btn-zap-redondo { position: absolute; top: 10px; right: 10px; width: 40px; cursor: pointer; }
    </style>
</head>
<body onload="document.getElementById('pageLoader').style.display='none';">

    <div id="pageLoader"><div class="loader-circle"></div></div>

    <div id="menuInicial" class="menu-caixa">
        <div class="banner-abertura">
            <img src="imagens_app/img_versus.png" class="img-versus" alt="Versus">
        </div>
        <p style="color:#444; font-weight: bold; margin: 5px 0;">Digite ou selecione um tema:</p>
        
		<input list="temasFilosoficos" id="seletorTema" class="seletor-tema" placeholder="Escreva seu pr√≥prio tema...">
       
		<datalist id="temasFilosoficos"></datalist>

        <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora Iniciar Duelo</button>
    </div>
    
    <div id="jogoArea" style="display:none;">
        <div class="cards-area" id="containerRunas">
            <div class="card-container">
                <div class="card">
                    <img id="fotoLunar" src="imagens_app/lunares.png">
                    <div class="label-card">LUNAR</div>
                </div>
                <div id="nomeLunar" class="nome-filosofo">Aguardando...</div>
            </div>
			
			
            <div class="card-container">
                <div class="card">
                    <img id="fotoSolar" src="imagens_app/solares.png">
                    <div class="label-card">SOLAR</div>
                </div>
                <div id="nomeSolar" class="nome-filosofo">Aguardando...</div>
            </div>
        </div>
        
        <button id="btnSorteio" class="btn-aurora roxo" onclick="sortear()">üÉè Sortear Gladiadores da Filosofia</button>
        <div id="status">Prepare-se para batalha de narrativas assistida por IA sem vi√©s passional</div>
        
        <div id="aiBox">
            <img src="imagens_app/zap.png" class="btn-zap-redondo" onclick="shareOnWhatsApp()">
            <div id="conteudoIA"></div>
            <button onclick="location.reload()" class="btn-aurora roxo" style="background:#2ecc71">Novo Duelo</button>
        </div>
    </div>

    <script>
        const filosofosLunares = ["Albert-Camus.png", "Adorno.png", "Benjamin.png", "Byung-Chul Han.png", "Carl Jung.png", "Emil Cioran.png", "Fernando Pessoa.png", "Foucault.png", "Freud.png", "Georges Bataille.png", "Gilles Deleuze.png", "Guy Debord.png", "Hannah Arendt.png", "Heidegger.png", "Heraclito.png", "Huizinga.png", "Hume.png", "Jacques Derrida.png", "John Gray.png", "Kierkegaard.png", "Lucrecio.png", "Ludwig Wittgenstein.png", "Nietzsche.png", "Pascal.png", "Peter Zapfee.png", "Santo Agostinho.png", "Sartre.png", "Schopenhauer.png", "Unamuno.png", "Vil√©m Flusser.png"];
        const filosofosSolares = ["Aristoteles.png", "Bernard Suits.png", "Bostrom.png", "Buno Latour.png", "Cicero.png", "Comte.png", "Descartes.png", "Durkheim.png", "Francis Bacon.png", "Habermas.png", "Harari.png", "Hegel.png", "John Nash.png", "Kant.png", "Leibniz.png", "Locke.png", "Marx.png", "Mill.png", "Montesquieu.png", "Pitagoras.png", "Platao.png", "Roger Caillois.png", "Rousseau.png", "Sloterdijk.png", "Socrates.png", "Spinoza.png", "Steve Bannon.png", "Thomas Schelling.png", "Tomas de Aquino.png", "Weber.png"];

        let lunarSorteado = "";
        let solarSorteado = "";

		
fetch("https://raw.githubusercontent.com/seabhra/allora-filosofal-api/main/temas_filosoficos.json")
  .then(res => {
    if (!res.ok) throw new Error("Erro HTTP " + res.status);
    return res.json();
  })
  .then(data => {
    const datalist = document.getElementById("temasFilosoficos");
    datalist.innerHTML = "";

    data.temas.forEach(tema => {
      const option = document.createElement("option");
      option.value = tema;
      datalist.appendChild(option);
    });
  })
  .catch(err => {
    console.error("Erro ao carregar temas:", err);
  });




        function iniciarDuelo() {
            document.getElementById('menuInicial').style.display = 'none';
            document.getElementById('jogoArea').style.display = 'block';
            document.getElementById('containerRunas').style.display = 'flex';
        }

        function sortear() {
            const btn = document.getElementById('btnSorteio');
            btn.disabled = true;
            btn.innerText = "‚è≥ Convocando Pensadores ao Conclave de Narrativas...";
            
            let ciclos = 0;
            const intervalo = setInterval(() => {
                const tempL = filosofosLunares[Math.floor(Math.random() * filosofosLunares.length)];
                const tempS = filosofosSolares[Math.floor(Math.random() * filosofosSolares.length)];
                
                document.getElementById('fotoLunar').src = "imagens_lunares_png/" + tempL;
                document.getElementById('fotoSolar').src = "imagens_solares_png/" + tempS;
                
                document.getElementById('nomeLunar').innerText = tempL.replace('.png', '').replace(/-/g, ' ');
                document.getElementById('nomeSolar').innerText = tempS.replace('.png', '').replace(/-/g, ' ');

                if (ciclos++ > 32) {
                    clearInterval(intervalo);
                    lunarSorteado = tempL.replace('.png', '');
                    solarSorteado = tempS.replace('.png', '');
                    gerarConfrontoIA();
                }
            }, 100);
        }

        async function gerarConfrontoIA() {
            const statusEl = document.getElementById('status');
            const tema = document.getElementById('seletorTema').value || "Exist√™ncia";
            statusEl.innerText = "Aguarde... Os fil√≥sofos est√£o debatendo.";

            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{
                            role: "user",
                            content: `Promova um duelo de ideias curto e intenso entre ${lunarSorteado} e ${solarSorteado} sobre o tema: ${tema}.`
                        }]
                    })
                });

                const data = await res.json();
                const textoIA = data.choices[0].message.content;

                document.getElementById('btnSorteio').style.display = 'none';
                document.getElementById('conteudoIA').innerHTML = `
                    <h3 style="color:#4a148c; text-align:center">‚öîÔ∏è ${lunarSorteado} vs ${solarSorteado}</h3>
                    <p style="font-size:13px; color:#666"><strong>Tema:</strong> ${tema}</p>
                    <hr>
                    <p>${textoIA.replace(/\n/g, '<br>')}</p>
                `;
                document.getElementById('aiBox').style.display = 'block';
                statusEl.innerText = "O debate foi conclu√≠do.";
            } catch (e) {
                statusEl.innerText = "Erro na conex√£o.";
            }
        }

        function shareOnWhatsApp() {
            const texto = document.querySelector('#conteudoIA').innerText;
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent("üî• Veja este duelo filos√≥fico:\n\n" + texto)}`, '_blank');
        }
    </script>
</body>
</html>

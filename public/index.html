<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
crossorigin="anonymous"></script>

<!-- Favicon -->
<link rel="icon" href="./favicon.ico" type="image/x-icon">

<!-- √çcones PWA -->
<link rel="apple-touch-icon" sizes="192x192" href="./public/icons/icon-192.png">

<!-- Manifest json -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#6b46c1">
<title>Allora (re)Narrar - Duelo de Ideias Sem Paix√£o</title>

<style>
* { box-sizing: border-box; }

body {
margin: 0;
padding: 10px;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #fdfcfd;
color: white;
text-align: center;
overflow-x: hidden;
display: flex;
justify-content: center; 
align-items: center; 
min-height: 100vh;
}

#pageLoader {
position: fixed; inset: 0; background: #fdfcfd; /* Fundo branco/claro */
z-index: 9999; display: flex; align-items: center; justify-content: center;
}

.loader-circle {
width: 60px; height: 60px; border: 6px solid #e0e0e0;
border-top: 6px solid #d847cf; border-radius: 50%; animation: spin 1.5s linear infinite;
}

@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* Container Principal para garantir centraliza√ß√£o e largura consistente */
.app-container {
width: 100%;
max-width: 360px; /* Mesma largura do menu inicial */
display: flex;
flex-direction: column;
align-items: center;
}

.menu-caixa {
background: rgba(69, 89, 222, 0.9);
backdrop-filter: blur(6px);
color: #333;
padding: 20px 15px;
border-radius: 20px;
width: 100%;
box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

#erroTema {
color: #ffeb3b; /* Amarelo para contraste melhor no fundo roxo */
font-size: 12px;
font-weight: bold;
display: none;
margin-bottom: 10px;
}

.img-espadas {
display: block;
margin: -40px auto 10px; 
width: 100%;
max-width: 260px;
aspect-ratio: 1 / 1;
object-fit: contain;
}

.img-versus-central {
width: 40px;
height: 40px;
align-self: center;
object-fit: contain;
margin: -10px 5px; 
}

.seletor-tema {
width: 100%; padding: 12px; margin: 10px 0;
border-radius: 12px; border: 2px solid #9d5fe9;
background: white; font-weight: bold; color: #4a148c;
}

.btn-aurora {
width: 100%; padding: 12px; margin: 6px 0; border: none;
border-radius: 16px; font-weight: bold; cursor: pointer;
color: white; font-size: 16px; transition: transform 0.2s ease;
}

.btn-aurora:active { transform: scale(0.97); }

.roxo { background: #98df4c; color: #1a1a1a; } 
.rosa { background: #f49bb9; color: #1a1a1a; }
.azul-info { background: #4caedf; cursor: default; color: white; } 
.verde { background: #5ae9e9; color: #1a1a1a; } 

#jogoArea {
display: none;
width: 100%;
flex-direction: column;
align-items: center;
}

.cards-area {
display: none; justify-content: center; gap: 5px;
margin: 10px auto 20px; padding: 10px; background: rgba(255,255,255,0.2);
border-radius: 20px; flex-wrap: nowrap;
align-items: center;
width: 100%;
}

.card-container { width: 48%; height: 220px; display: flex; flex-direction: column; align-items: center;}

.card {
width: 100%; height: 190px; background: #1a1a1a;
border-radius: 12px; border: 3px solid #fff; overflow: hidden;
box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative;
margin-bottom: 5px;
}

.card img { width: 100%; height: 100%; object-fit: cover; object-position: top; }

.label-card {
position: absolute; top: 0; width: 100%; background: rgba(0,0,0,0.7);
color: #fff; font-size: 10px; padding: 2px; font-weight: bold;
white-space: nowrap;
}

.nome-filosofo {
background: #638da3; color: white;
font-size: 11px; padding: 4px; border-radius: 8px;
width: 100%;
min-height: 30px; display: flex; align-items: center; justify-content: center;
line-height: 1.1; font-weight: bold;
}

#status {
margin: 15px auto;
font-size: 13px;
color: #555; /* Texto escuro para leitura no fundo claro */
background: rgba(255,255,255,0.8);
padding: 10px;
width: 100%;
border-radius: 10px;
display: block;
text-align: left;
}

#aiBox {
display: none;
background: white;
color: #333;
padding: 15px;
border-radius: 15px;
text-align: left;
margin: 15px 0;
width: 100%;
font-size: 14px;
line-height: 1.5;
box-shadow: 0 5px 15px rgba(0,0,0,0.2);
position: relative;
border: 1px solid #eee;
}

.btn-zap-redondo { 
position: absolute; top: -15px; right: -10px; 
width: 45px; height: 45px; 
cursor: pointer; z-index: 10; 
transition: transform 0.2s;
}
.btn-zap-redondo:hover { transform: scale(1.1); }

#ad-container {
margin-top: 20px;
min-height: 100px;
background-color: #f9f9f9;
border-radius: 8px;
padding: 5px;
border: 1px solid #ddd;
}
</style>
</head>

<body onload="document.getElementById('pageLoader').style.display='none';">
<div id="pageLoader"><div class="loader-circle"></div></div>

<div class="app-container">
  
  <!-- MENU INICIAL -->
  <div id="menuInicial" class="menu-caixa">
    <div class="banner-abertura">
        <img src="imagens_app/img_espadas.png" class="img-espadas" alt="Espadas">
    </div>
    <p style="color:#ede4e4; font-weight: bold; margin: 5px 0;">Digite ou selecione um tema:</p>
    <div id="erroTema">‚ö†Ô∏è Por favor, escolha um tema antes de iniciar!</div>
    <input list="temasFilosoficos" id="seletorTema" class="seletor-tema" placeholder="Escreva seu pr√≥prio tema...">
    <datalist id="temasFilosoficos"></datalist>
    <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora (re)Narrar</button>
  </div>

  <!-- √ÅREA DE JOGO -->
  <div id="jogoArea">
    <div class="cards-area" id="containerFilosofos">
        <div class="card-container">
            <div class="card">
                <img id="fotoLunar" src="imagens_app/lunares.png">
                <div class="label-card">Lunares: desconfiam!</div>
            </div>
            <div id="nomeLunar" class="nome-filosofo">Prontos para duelar...</div>
        </div>
        <img src="imagens_app/verusX.png" class="img-versus-central">
        <div class="card-container">
            <div class="card">
                <img id="fotoSolar" src="imagens_app/solares.png">
                <div class="label-card">Solares: prometem!</div>
            </div>
            <div id="nomeSolar" class="nome-filosofo">Prontos para duelar...</div>
        </div>
    </div>

    <div id="areaBotaoAcao">
        <button id="btnSorteio" class="btn-aurora rosa" onclick="sortear()">üÉèBora MetaNarrar Cl√°ssicos</button>
    </div>

    <div id="status">Prepara-se... Em jogo a grande batalha do pensamento humano sem vi√©s passional. Agora √© a hora de exorcizar seus fantasmas narrativos que as redes lhe impuseram ‚Äî e que voc√™ ainda assume como seus. Jogue sem d√≥ e mate o que est√° te matando: a mentira intencional por mais poder pol√≠tico, econ√¥mico e religioso. Quando jogar tamb√©m √© ler.</div>

    <!-- CAIXA DE RESULTADO E AN√öNCIO -->
    <div id="aiBox">
        <div id="ad-container">
            <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3940256099942544"
                 data-ad-slot="6300978111"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

  </div>
</div> <!-- Fim app-container -->

<script>
// ---------------- √ÅUDIO ----------------
const shuffleAudio = new Audio('audio_app/slots_machine.mp3');
shuffleAudio.preload = 'auto';

const memoriesAudio = new Audio('audio_app/darren_curtis.mp3');     
memoriesAudio.loop = true;
memoriesAudio.preload = 'auto';
// Configura volume (opcional, recomendado para n√£o assustar o usu√°rio)
memoriesAudio.volume = 0.5;
shuffleAudio.volume = 0.5;

// ---------------- DADOS E INICIALIZA√á√ÉO ----------------
const filosofosLunares = ["Albert-Camus.png", "Adorno.png", "Benjamin.png", "Byung-Chul-Han.png", "Carl-Jung.png", "Emil-Cioran.png", "Fernando-Pessoa.png", "Foucault.png", "Freud.png", "Georges-Bataille.png", "Gilles-Deleuze.png", "Guy-Debord.png", "Hannah-Arendt.png", "Heidegger.png", "Heraclito.png", "Huizinga.png", "Hume.png", "Jacques-Derrida.png", "John-Gray.png", "Kierkegaard.png", "Lucrecio.png", "Ludwig-Wittgenstein.png", "Nietzsche.png", "Pascal.png", "Peter-Zapfee.png", "Santo-Agostinho.png", "Sartre.png", "Schopenhauer.png", "Unamuno.png", "Vil√©m-Flusser.png"];
const filosofosSolares = ["Aristoteles.png", "Bernard Suits.png", "Bostrom.png", "Buno Latour.png", "Cicero.png", "Comte.png", "Descartes.png", "Durkheim.png", "Francis Bacon.png", "Habermas.png", "Harari.png", "Hegel.png", "John Nash.png", "Kant.png", "Leibniz.png", "Locke.png", "Marx.png", "Mill.png", "Montesquieu.png", "Pitagoras.png", "Platao.png", "Roger Caillois.png", "Rousseau.png", "Sloterdijk.png", "Socrates.png", "Spinoza.png", "Steve Bannon.png", "Thomas Schelling.png", "Tomas de Aquino.png", "Weber.png"];

let lunarSorteado = "";
let solarSorteado = "";
   // --- FUN√á√ÉO PARA PARAR TODOS OS √ÅUDIOS ---
        function pararAudios() {
            if(memoriesAudio) {
                memoriesAudio.pause();
                memoriesAudio.currentTime = 0;
            }
            if(shuffleAudio) {
                shuffleAudio.pause();
                shuffleAudio.currentTime = 0;
            }
        }
// Carregar temas do JSON
fetch("https://raw.githubusercontent.com/seabhra/allora-filosofal-api/main/temas_filosoficos.json")
.then(res => res.json())
.then(data => {
  const datalist = document.getElementById("temasFilosoficos");
  datalist.innerHTML = "";
  data.temas.forEach(tema => {
      const option = document.createElement("option");
      option.value = tema;
      datalist.appendChild(option);
  });
}).catch(err => console.log("Erro ao carregar temas:", err));

function iniciarDuelo() {
  const temaInput = document.getElementById('seletorTema').value;
  const erroEl = document.getElementById('erroTema');
  if (temaInput.trim() === "") {
      erroEl.style.display = 'block';
      return;
  }
  erroEl.style.display = 'none';
  
  // Troca de telas
  document.getElementById('menuInicial').style.display = 'none';
  document.getElementById('jogoArea').style.display = 'flex';
  document.getElementById('containerFilosofos').style.display = 'flex';
}

function sortear() {
  // Resetar √°udios
  memoriesAudio.pause();
  memoriesAudio.currentTime = 0;
  shuffleAudio.currentTime = 0;
  
  // Tocar som de shuffle (ignora erro se n√£o houver intera√ß√£o do usu√°rio ainda)
  shuffleAudio.play().catch(e => console.log("Interagir primeiro para tocar som"));

  document.getElementById('status').innerText = "No Conclave das Metanarrativas, 62 fil√≥sofos entre lunares e solares disputam mais de 2.500 anos de hist√≥ria intelectual. Agora a luta √© contra o julgo das paix√µes narrativas induzidas nas redes com pouco controle institucional. Na arena dos Tit√£s do Pensamento, Allora (re)Narrar est√° armada at√© os dentes ‚Äî uma IA treinada para barrar que discursos passionais sabotem qualquer conhecimento informado.";
  
  const areaBotao = document.getElementById('areaBotaoAcao');
  areaBotao.innerHTML = `<button class="btn-aurora azul-info">Cl√°ssicos em combate...</button>`;

  // Ocultar resultado anterior se houver
  const aiBox = document.getElementById('aiBox');
  if(aiBox.style.display === 'block') {
      aiBox.style.display = 'none';
  }

  let ciclos = 0;
  const intervalo = setInterval(() => {
      const tempL = filosofosLunares[Math.floor(Math.random() * filosofosLunares.length)];
      const tempS = filosofosSolares[Math.floor(Math.random() * filosofosSolares.length)];
      document.getElementById('fotoLunar').src = "imagens_lunares_png/" + tempL;
      document.getElementById('fotoSolar').src = "imagens_solares_png/" + tempS;
      document.getElementById('nomeLunar').innerText = tempL.replace('.png', '').replace(/-/g, ' ');
      document.getElementById('nomeSolar').innerText = tempS.replace('.png', '').replace(/-/g, ' ');

      if (ciclos++ > 100) {
          clearInterval(intervalo);
          shuffleAudio.pause();
          lunarSorteado = tempL.replace('.png', '');
          solarSorteado = tempS.replace('.png', '');
          gerarConfrontoIA();
      }
  }, 90);
}

// ---------------- API IA ----------------
async function gerarConfrontoIA() {
  const statusEl = document.getElementById('status');
  const tema = document.getElementById('seletorTema').value || "Exist√™ncia";

  statusEl.innerText = "Aguarde um instante... os fil√≥sofos sorteados travam um duelo jur√°ssico em nome da verdade sem vi√©s passional...";

  try {
      const promptTexto = `Promova um duelo de ideias sem vi√©s passional entre ${lunarSorteado} e ${solarSorteado} sobre o tema: ${tema}.`;

      const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
              messages: [{ role: 'user', content: promptTexto }],
              model: 'llama-3.3-70b-versatile'
          })
      });

      if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          throw new Error(`API respondeu ${res.status}: ${errData.error || 'Erro desconhecido'}`);
      }

      const data = await res.json();

      if (!data.choices || !data.choices[0] || !data.choices[0].message) {
          throw new Error("A API retornou uma estrutura de dados inv√°lida.");
      }

      const respostaTexto = data.choices[0].message.content;
      const aiBox = document.getElementById('aiBox');

      // Renderiza o conte√∫do
      aiBox.innerHTML = `
        <h2 class="ai-title" style="color:#4a148c; margin-top:0; font-size:18px;">
          <img src="public/imagens_app/logo_circular.png" class="ai-logo" style="width:25px; vertical-align:middle; margin-right:8px;">
          Allora Assistente de IA
        </h2>
        
        <div id="conteudoIA" style="margin-bottom: 15px;">
          <h3 style="color:#4a148c; text-align:center; margin: 10px 0; font-size:16px;">
              ‚öîÔ∏è ${lunarSorteado} vs ${solarSorteado}
          </h3>
          <p style="font-size:12px; color:#666; text-align:center; margin-bottom:10px">
              <strong>Tema em disputa:</strong> ${tema}
          </p>
          <hr style="border:0; border-top:1px solid #eee;">
          <p style="font-size:14px; text-align:justify; color:#333;">${respostaTexto.replace(/\n/g, '<br>')}</p>
        </div>

        <img src="public/imagens_app/zap.png"
             class="btn-zap-redondo"
             onclick="shareOnWhatsApp()"
             alt="Compartilhar">

        <div id="ad-container">
          <span style="font-size:10px;color:#999;text-align:center;display:block">Publicidade</span>
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-3940256099942544"
               data-ad-slot="6300978111"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
        </div>
      `;

      aiBox.style.display = 'block';
      statusEl.innerText = "O grande duelo foi conclu√≠do.";
      statusEl.style.textAlign = "center";
      statusEl.style.color = "#00cc66";
      statusEl.style.fontWeight = "500";

      // Carregar o an√∫ncio novamente
      try {
          (window.adsbygoogle = window.adsbygoogle || []).push({});
      } catch (e) {
          console.error("Erro ao carregar an√∫ncio:", e);
      }

      document.getElementById('areaBotaoAcao').innerHTML = `
        <button onclick="location.reload()" class="btn-aurora verde">
          ‚ôªÔ∏è Novo Combate de Tit√£s
        </button>
      `;

  } catch (e) {
      console.error(e);
      statusEl.innerText = "Erro ao acessar a IA: " + e.message;
      statusEl.style.color = "red";
      document.getElementById('areaBotaoAcao').innerHTML = `
          <button onclick="location.reload()" class="btn-aurora verde">
          ‚ôªÔ∏è Novo Combate de Tit√£s
          </button>
      `;
  }
}

// ---------------- WHATSAPP ----------------
function shareOnWhatsApp() {
  const box = document.getElementById('conteudoIA');
  
  if (!box) {
      alert("Conte√∫do n√£o encontrado para compartilhar.");
      return;
  }

  let texto = box.innerText;

  if (!texto) {
      alert("Ainda n√£o h√° duelo para compartilhar.");
      return;
  }

  if (texto.length > 2000) {
      texto = texto.substring(0, 2000) + "...";
  }

  const title = "Allora (re)Narrar";
  const WHATSAPP_FOOTER = "\n\nüîÆ Allora (re)Narrar ‚Äî IA do Conhecimento\n‚ö° Powered by Geraldo A. Seabra";
  const message = `‚ú® ${title}\n\n${texto}${WHATSAPP_FOOTER}`;

  if (window.AppInventor) {
      window.AppInventor.setWebViewString(message);
  } else {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
  }
}

// ---------------- SERVICE WORKER ----------------
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('ServiceWorker registration successful'))
      .catch(err => console.log('ServiceWorker registration failed: ', err));
  });
}
</script>
</body>
</html>



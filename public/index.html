<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Script do AdSense (Deve ficar no head) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3940256099942544"
    crossorigin="anonymous"></script>

<!-- Favicon -->
<link rel="icon" href="./favicon.ico" type="image/x-icon">

<!-- √çcones PWA -->
<link rel="apple-touch-icon" sizes="192x192" href="./public/icons/icon-192.png">

<!-- Manifest json -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#6b46c1">

    <title>Allora - Duelo de Ideias Sem Paix√£o</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fdfcfd;
            color: white;
            text-align: center;
            overflow-x: hidden;
            display: flex;
            flex-direction: column; /* Importante para o fluxo vertical */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #pageLoader {
            position: fixed; inset: 0; background: transparent; /* Corrigido: transparente -> transparent */
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }

        .loader-circle {
            width: 60px; height: 60px; border: 6px solid #fdfcfd;
            border-top: 6px solid #d847cf; border-radius: 50%; animation: spin 1.5s linear infinite;
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .menu-caixa {
            background: rgba(69, 89, 222, 0.9);
            backdrop-filter: blur(6px);
            color: #333;
            padding: 5px;
            border-radius: 20px;
            height: 400px;
            max-width: 360px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }

        #erroTema {
            color: #ffeb3b; /* Cor ajustada para melhor leitura */
            font-size: 12px;
            font-weight: bold;
            display: none;
            margin-bottom: 5px;
        }

        .img-espadas {
            display: block;
            margin: -30px auto;
            width: 100vw;
            max-width: 280px;
            aspect-ratio: 1 / 1;
            object-fit: contain;
        }

        .img-versus-central {
            width: 40px;
            height: 40px;
            align-self: center;
            object-fit: contain;
            margin: -10px 5px;
        }

        .seletor-tema {
            width: 100%; padding: 12px; margin: 10px 0;
            border-radius: 12px; border: 2px solid #9d5fe9;
            background: white; font-weight: bold; color: #4a148c;
        }

        .btn-aurora { 
            width: 100%; padding: 12px; margin: 6px 0; border: none; 
            border-radius: 16px; font-weight: bold; cursor: pointer; 
            color: white; font-size: 16px; transition: transform 0.2s ease;
        }

        .btn-aurora:active { transform: scale(0.97); }
        .roxo { background: #98df4c; }
        .rosa { background: #f49bb9; }
        .azul-info { background: #4caedf; cursor: default; }
        .verde { background: #5ae9e9; }

        .cards-area { 
            display: none; justify-content: center; gap: 10px; 
            margin: 12px auto 40px; padding: 15px 10px; background: rgba(255,255,255,0.2);
            border-radius: 20px; flex-wrap: nowrap;
            align-items: center;
            max-width: 420px;
        }

        .card-container { width: 185px; height: 220px;} 

        .card { 
            width: 100%; height: 220px; background: #1a1a1a; 
            border-radius: 12px; border: 3px solid #fff; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative;
        }

        .card img { width: 100%; height: 95%; object-fit: cover; object-position: top; }

        .label-card { 
            position: absolute; top: 0; width: 100%; background: rgba(0,0,0,0.7);
            color: #fff; font-size: 11.5px; padding: 4px 2px; font-weight: bold;
            white-space: nowrap;
        }

        .nome-filosofo {
            margin-top: 8px; background: #638da3; color: white;
            font-size: 11px; padding: 6px; border-radius: 8px;
            min-height: 35px; display: flex; align-items: center; justify-content: center;
            line-height: 1.1; font-weight: bold;
        }

        #status {
            margin: 10px auto;
            font-size: 14px;
            color: #979494;
            font-weight: normal;
            padding: 0 15px;
            max-width: 420px;
            text-align: left;
            display: block;
        }

        #aiBox { 
            display: none; 
            background: white; 
            color: #333; 
            padding: 18px; 
            border-radius: 15px; 
            text-align: left; 
            margin: 15px auto; 
            max-width: 420px;
            font-size: 15px; 
            line-height: 1.6; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        /* SVG do WhatsApp inline para garantir que apare√ßa */
        .btn-zap-redondo { 
            position: absolute; top: 10px; right: 10px; 
            width: 40px; height: 40px; cursor: pointer; 
            background: #25D366; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-zap-redondo svg { width: 24px; height: 24px; fill: white; }

        #btnSorteio {
            max-width: 420px;
            margin: 6px auto;
            display: block;
        }

        /* Estilos para o container do an√∫ncio */
        #ad-container {
            margin: 20px auto;
            min-height: 100px; /* Reserva espa√ßo */
            max-width: 420px;
            width: 100%;
            text-align: center;
            background: rgba(255,255,255,0.1); /* Leve fundo para visualiza√ß√£o */
            border-radius: 10px;
            padding: 5px;
        }

    </style>
</head>

<body onload="document.getElementById('pageLoader').style.display='none';">

    <div id="pageLoader"><div class="loader-circle"></div></div>

    <div id="menuInicial" class="menu-caixa">
        <div class="banner-abertura">
            <img src="imagens_app/img_espadas.png" class="img-espadas" alt="Espadas" onerror="this.style.display='none'">
        </div>
        <p style="color:#ede4e4; font-weight: bold; margin: 5px 0;">Digite ou selecione um tema:</p>
        <div id="erroTema">‚ö†Ô∏è Por favor, escolha um tema antes de iniciar!</div>
        <input list="temasFilosoficos" id="seletorTema" class="seletor-tema" placeholder="Escreva seu pr√≥prio tema do momento...">
        <datalist id="temasFilosoficos"></datalist>
        <button onclick="iniciarDuelo()" class="btn-aurora roxo">‚öîÔ∏è Bora Duelar no Modo Profundo</button>
    </div>
    
    <div id="jogoArea" style="display:none;">
        <div class="cards-area" id="containerFilosofos">
            <div class="card-container">
                <div class="card">
                    <img id="fotoLunar" src="imagens_app/lunares.png" onerror="this.src='https://picsum.photos/seed/lunares/200/220'">
                    <div class="label-card">Lunares: desconfiam!</div>
                </div>
                <div id="nomeLunar" class="nome-filosofo">Prontos para duelar...</div>
            </div>
            
            <img src="imagens_app/verusX.png" class="img-versus-central" onerror="this.src='https://picsum.photos/seed/versus/40/40'">
            
            <div class="card-container">
                <div class="card">
                    <img id="fotoSolar" src="imagens_app/solares.png" onerror="this.src='https://picsum.photos/seed/solares/200/220'">
                    <div class="label-card">Solares: prometem!</div>
                </div>
                <div id="nomeSolar" class="nome-filosofo">Prontos para duelar...</div>
            </div>
        </div>
        
        <div id="areaBotaoAcao">
            <button id="btnSorteio" class="btn-aurora rosa" onclick="sortear()">üÉèJogar Cl√°ssicos da Filosofia</button>
        </div>
        
        <div id="status">Prepara-se... Em jogo a grande batalha do pensamento humano sem vi√©s passional. Agora √© a hora de exorcizar seus fantasmas narrativos que as redes lhe impuseram ‚Äî e que voc√™ ainda assume como seus. Jogue sem d√≥ e mate o que est√° te matando: a mentira intencional por mais poder pol√≠tico, econ√¥mico e religioso. Quando jogar tamb√©m √© ler...</div>
        
        <div id="aiBox">
            <!-- √çcone WhatsApp -->
            <div class="btn-zap-redondo" onclick="shareOnWhatsApp()">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
            </div>
            <div id="conteudoIA"></div>
        </div>

        <!-- Container do An√∫ncio posicionado AP√ìS o aiBox -->
        <div id="ad-container">
            <!-- O conte√∫do do an√∫ncio ser√° injetado aqui via JS -->
        </div>
        
    </div>

    <script>
        const filosofosLunares = ["Albert-Camus.png", "Adorno.png", "Benjamin.png", "Byung-Chul-Han.png", "Carl-Jung.png", "Emil-Cioran.png", "Fernando-Pessoa.png", "Foucault.png", "Freud.png", "Georges-Bataille.png", "Gilles-Deleuze.png", "Guy-Debord.png", "Hannah-Arendt.png", "Heidegger.png", "Heraclito.png", "Huizinga.png", "Hume.png", "Jacques-Derrida.png", "John-Gray.png", "Kierkegaard.png", "Lucrecio.png", "Ludwig-Wittgenstein.png", "Nietzsche.png", "Pascal.png", "Peter-Zapffe.png", "Santo-Agostinho.png", "Sartre.png", "Schopenhauer.png", "Unamuno.png", "Vil√©m-Flusser.png"];
        const filosofosSolares = ["Aristoteles.png", "Bernard Suits.png", "Bostrom.png", "Buno Latour.png", "Cicero.png", "Comte.png", "Descartes.png", "Durkheim.png", "Francis Bacon.png", "Habermas.png", "Harari.png", "Hegel.png", "John Nash.png", "Kant.png", "Leibniz.png", "Locke.png", "Marx.png", "Mill.png", "Montesquieu.png", "Pitagoras.png", "Platao.png", "Roger Caillois.png", "Rousseau.png", "Sloterdijk.png", "Socrates.png", "Spinoza.png", "Steve Bannon.png", "Thomas Schelling.png", "Tomas de Aquino.png", "Weber.png"];

        let lunarSorteado = "";
        let solarSorteado = "";

        fetch("https://raw.githubusercontent.com/seabhra/allora-filosofal-api/main/temas_filosoficos.json")
          .then(res => res.json())
          .then(data => {
            const datalist = document.getElementById("temasFilosoficos");
            datalist.innerHTML = "";
            data.temas.forEach(tema => {
              const option = document.createElement("option");
              option.value = tema;
              datalist.appendChild(option);
            });
          })
          .catch(err => console.log("Erro ao carregar temas (usando padr√£o)"));

        function iniciarDuelo() {
            const temaInput = document.getElementById('seletorTema').value;
            const erroEl = document.getElementById('erroTema');
            if (temaInput.trim() === "") {
                erroEl.style.display = 'block';
                return;
            }
            erroEl.style.display = 'none';
            document.getElementById('menuInicial').style.display = 'none';
            document.getElementById('jogoArea').style.display = 'block';
            document.getElementById('containerFilosofos').style.display = 'flex';
        }

        function sortear() {
            document.getElementById('status').innerText = "No Conclave das Altas Narrativas, 62 fil√≥sofos entre lunares e solares disputam mais de 2.500 anos de hist√≥ria intelectual. Agora a luta √© contra o julgo das paix√µes narrativas induzidas nas redes com pouco controle institucional. Na entrada da arena de combate, Allora Pensa est√° armada at√© os dentes ‚Äî uma IA treinada para barrar que discursos passionais sabotem qualquer conhecimento informado.";

            const areaBotao = document.getElementById('areaBotaoAcao');
            areaBotao.innerHTML = `<button class="btn-aurora azul-info">Cl√°ssicos em combate: eles ainda pensam...</button>`;
            
            // Esconde o an√∫ncio antigo se houver
            document.getElementById('ad-container').innerHTML = "";
            document.getElementById('ad-container').style.display = 'none';

            let ciclos = 0;
            const intervalo = setInterval(() => {
                const tempL = filosofosLunares[Math.floor(Math.random() * filosofosLunares.length)];
                const tempS = filosofosSolares[Math.floor(Math.random() * filosofosSolares.length)];
                
                document.getElementById('fotoLunar').src = "imagens_lunares_png/" + tempL;
                document.getElementById('fotoSolar').src = "imagens_solares_png/" + tempS;
                
                document.getElementById('nomeLunar').innerText = tempL.replace('.png', '').replace(/-/g, ' ');
                document.getElementById('nomeSolar').innerText = tempS.replace('.png', '').replace(/-/g, ' ');

                if (ciclos++ > 100) {
                    clearInterval(intervalo);
                    lunarSorteado = tempL.replace('.png', '');
                    solarSorteado = tempS.replace('.png', '');
                    gerarConfrontoIA();
                }
            }, 90);
        }

async function gerarConfrontoIA() {
  const statusEl = document.getElementById('status');
  const tema = document.getElementById('seletorTema').value || "Exist√™ncia";

  statusEl.innerText = "Aguarde um instante... os fil√≥sofos sorteados travam um duelo jur√°ssico em nome da verdade sem vi√©s passional...";

  try {
    const promptTexto = `Promova um duelo de ideias sem vi√©s passional entre ${lunarSorteado} e ${solarSorteado} sobre o tema: ${tema}.`;

    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        messages: [
          { role: 'user', content: promptTexto }
        ],
        model: 'llama-3.3-70b-versatile'
      })
    });

    if (!res.ok) {
      const errData = await res.json().catch(() => ({}));
      throw new Error(`API respondeu ${res.status}: ${errData.error || 'Erro desconhecido'}`);
    }

    const data = await res.json();

    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
      throw new Error("A API retornou uma estrutura de dados inv√°lida.");
    }

    const respostaTexto = data.choices[0].message.content;

    // 1. Inserir o conte√∫do no AIBox
    document.getElementById('conteudoIA').innerHTML = `
      <h3 style="color:#4a148c; text-align:center">
        ‚öîÔ∏è ${lunarSorteado} vs ${solarSorteado}
      </h3>
      <p style="font-size:13px; color:#666">
        <strong>Tema:</strong> ${tema}
      </p>
      <hr>
      <p>${respostaTexto.replace(/\n/g, '<br>')}</p>
    `;

    // 2. Mostrar a caixa de IA
    document.getElementById('aiBox').style.display = 'block';
    statusEl.innerText = "O grande duelo foi conclu√≠do.";

    // 3. CARREGAR O AN√öNCIO DINAMICAMENTE AP√ìS O CONTE√öDO
    carregarAnuncio();

    document.getElementById('areaBotaoAcao').innerHTML =
      `<button onclick="location.reload()" class="btn-aurora verde">
        ‚ôªÔ∏è Novo Combate de Tit√£s
      </button>`;

  } catch (e) {
    console.error(e);
    statusEl.innerText = "Erro ao acessar a IA: " + e.message;
    document.getElementById('areaBotaoAcao').innerHTML =
      `<button onclick="location.reload()" class="btn-aurora verde">
        ‚ôªÔ∏è Novo Combate de Tit√£s
      </button>`;
  }
}

// Fun√ß√£o dedicada para injetar e carregar o an√∫ncio
function carregarAnuncio() {
    const adContainer = document.getElementById('ad-container');
    
    // Mostra o container
    adContainer.style.display = 'block';

    // Injeta o HTML do an√∫ncio. Isso √© necess√°rio para 'resetar' o slot e for√ßar um novo carregamento
    adContainer.innerHTML = `
      <ins class="adsbygoogle"
           style="display:block; width: 100%; min-height: 100px;"
           data-ad-client="ca-pub-3940256099942544"
           data-ad-slot="6300978111"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
    `;

    // Aciona o script do Google AdSense para preencher o <ins> que acabamos de criar
    try {
      (adsbygoogle = window.adsbygoogle || []).push({});
    } catch (e) {
      console.error("Erro ao carregar an√∫ncio:", e);
    }
}

      function shareOnWhatsApp() {
    const elemento = document.querySelector('#conteudoIA');
    if (!elemento) return;
    const texto = elemento.innerText.trim();
    if (!texto) {
        alert("N√£o h√° texto para compartilhar.");
        return;
    }
    const mensagem = "üî• Veja este duelo filos√≥fico:\n\n" + texto;
    // Limita o tamanho para evitar erros de URL
    if(mensagem.length > 1000) { 
        // Se for muito grande, corta
    }
    const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(mensagem)}`;
    window.open(url, '_blank');
}

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registrado'))
                .catch(err => console.error('SW falhou', err));
        }

    </script>
</body>
</html>
